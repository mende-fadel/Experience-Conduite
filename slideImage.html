<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bilan - Fadelos</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <header>
        <nav>
            <div class="logo">
                üìä Bilan Conducteur
            </div>
            <div class="nav-links">
                <a href="index.html">Saisir</a>
                <a href="slideImage.html" class="active">Voir le Bilan</a>
            </div>
        </nav>
    </header>

    <div class="container-wide">
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalKm">0</div>
                <div class="stat-label">Kilom√®tres Totaux</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalSessions">0</div>
                <div class="stat-label">Sessions de conduite</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="favCar">-</div>
                <div class="stat-label">Derni√®re Voiture</div>
            </div>
        </div>

        <div class="card">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 20px;">
                <h2>Historique des trajets</h2>
                <button class="btn-danger" onclick="clearData()" style="padding: 8px 16px; font-size: 0.9rem;">üóëÔ∏è Tout effacer</button>
            </div>
            
            <div class="table-wrapper">
                <table id="dataTable">
                    <thead>
                        <tr>
                            <th>Conducteur</th>
                            <th>Date</th>
                            <th>Horaire</th>
                            <th>Km</th>
                            <th>Voiture</th>
                            <th>M√©t√©o</th>
                            <th>Route</th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
            </div>
            <p id="emptyMsg" style="text-align:center; padding: 20px; display:none;">Aucune donn√©e enregistr√©e.</p>
        </div>

    </div>

    <script>
        // On remet les m√™mes donn√©es de r√©f√©rence pour faire la correspondance ID -> Texte
        const dataRef = {
            meteo: {1: "Soleil ‚òÄÔ∏è", 2: "Neige ‚ùÑÔ∏è", 3: "Pluie üåßÔ∏è", 4: "Brouillard üå´Ô∏è", 5: "Verglas üßä", 6: "Orage ‚õàÔ∏è", 7: "Nuageux ‚òÅÔ∏è", 8: "Sable üèúÔ∏è"},
            voitures: {1: "Mercedes", 2: "Audi", 3: "Peugeot", 4: "Renault", 5: "BMW", 6: "Jeep", 7: "Toyota"},
            routes: {1: "Autoroute", 2: "R. Communale", 3: "R. Nationale", 4: "R. Europ√©enne", 5: "R. D√©part."}
        };

        window.onload = function() {
            loadDashboard();
        };

        function loadDashboard() {
            const history = JSON.parse(localStorage.getItem('listExperience')) || [];
            const tbody = document.querySelector('#dataTable tbody');
            const emptyMsg = document.getElementById('emptyMsg');
            
            tbody.innerHTML = ''; // Reset

            if (history.length === 0) {
                emptyMsg.style.display = 'block';
                return;
            }

            let totalKm = 0;

            // Boucle invers√©e pour voir les plus r√©cents en premier
            history.slice().reverse().forEach(item => {
                totalKm += parseFloat(item.km) || 0;

                const row = `
                    <tr>
                        <td><strong>${item.nom}</strong></td>
                        <td>${item.date}</td>
                        <td>${item.hDepart} - ${item.hFin}</td>
                        <td>${item.km} km</td>
                        <td>${dataRef.voitures[item.voitureId] || 'Inconnu'}</td>
                        <td>${dataRef.meteo[item.meteoId] || 'Inconnu'}</td>
                        <td>${dataRef.routes[item.routeId] || 'Inconnu'}</td>
                    </tr>
                `;
                tbody.insertAdjacentHTML('beforeend', row);
            });

            // Mise √† jour des stats
            document.getElementById('totalKm').textContent = totalKm.toFixed(1);
            document.getElementById('totalSessions').textContent = history.length;
            
            // Derni√®re voiture utilis√©e (si existe)
            const lastDrive = history[history.length - 1];
            if(lastDrive) {
                document.getElementById('favCar').textContent = dataRef.voitures[lastDrive.voitureId];
            }
        }

        function clearData() {
            if(confirm("√ätes-vous s√ªr de vouloir tout effacer ? Cette action est irr√©versible.")) {
                localStorage.removeItem('listExperience');
                location.reload();
            }
        }
    </script>
</body>
</html>